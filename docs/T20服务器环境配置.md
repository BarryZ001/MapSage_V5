# T20服务器环境配置

## 🖥️ 服务器环境信息

### 容器配置
- **容器名称**: `t20_mapsage_env`
- **基础镜像**: `ubuntu:20.04`
- **运行模式**: 特权模式 (`--privileged`)
- **网络模式**: 主机网络 (`--network=host`)
- **IPC模式**: 主机IPC (`--ipc=host`)

### 目录挂载映射

| 主机路径 | 容器路径 | 用途 |
|---------|---------|------|
| `/root/mapsage_project/code` | `/workspace/code` | 项目代码 |
| `/data/datasets` | `/workspace/data` | 数据集存储 |
| `/root/mapsage_project/weights` | `/workspace/weights` | 模型权重 |
| `/root/mapsage_project/outputs` | `/workspace/outputs` | 训练输出 |

---

## 📁 数据集配置

### 1. LoveDA数据集
- **路径**: `/workspace/data/loveda`
- **用途**: 遥感图像语义分割
- **结构**:
  ```
  loveda/
  ├── Test/
  │   ├── Rural/images_png
  │   └── Urban/images_png
  ├── Train/
  │   ├── Rural/
  │   │   ├── images_png
  │   │   └── masks_png
  │   └── Urban/
  │       ├── images_png
  │       └── masks_png
  └── Val/
      ├── Rural/
      │   ├── images_png
      │   └── masks_png
      └── Urban/
          ├── images_png
          └── masks_png
  ```

### 2. MMRS1M数据集
- **路径**: `/workspace/data/mmrs1m`
- **用途**: 多模态遥感数据集
- **结构**:
  ```
  mmrs1m/
  └── data/
      ├── caption/          # 图像描述任务
      ├── classification/   # 分类任务
      ├── detection/        # 目标检测任务
      ├── json/            # 标注文件
      ├── RSVG/            # 视觉定位任务
      └── VQA/             # 视觉问答任务
  ```

### 3. EarthVQA数据集
- **路径**: `/workspace/data/EarthVQA`
- **用途**: 地球科学视觉问答
- **结构**:
  ```
  EarthVQA/
  ├── Test/
  │   └── images_png
  ├── Test_QA.json
  ├── Train/
  │   ├── images_png
  │   └── masks_png
  ├── Train_QA.json
  ├── Val/
  │   ├── images_png
  │   └── masks_png
  └── Val_QA.json
  ```

---

## 🚀 容器启动命令

```bash
docker run -dit \
  --name t20_mapsage_env \
  --privileged \
  --ipc=host \
  --network=host \
  -v /root/mapsage_project/code:/workspace/code \
  -v /data/datasets:/workspace/data \
  -v /root/mapsage_project/weights:/workspace/weights \
  -v /root/mapsage_project/outputs:/workspace/outputs \
  ubuntu:20.04
```

---

## 🔧 工作流程

### 本地开发流程
1. **Mac本地修改代码**
2. **提交到GitHub**
   ```bash
   git add .
   git commit -m "更新内容"
   git push origin main
   ```

### 服务器部署流程
1. **进入容器**
   ```bash
   docker exec -it t20_mapsage_env /bin/bash
   ```

2. **更新代码**
   ```bash
   cd /workspace/code
   git pull origin main
   ```

3. **运行程序**
   ```bash
   # 执行适配
   ./scripts/quick_adapt_t20.sh
   
   # 运行验证
   python scripts/validate_tta.py
   ```

---

## 📊 路径配置检查

### 验证数据集路径
```bash
# 检查数据集是否正确挂载
ls -la /workspace/data/loveda
ls -la /workspace/data/mmrs1m
ls -la /workspace/data/EarthVQA
```

### 验证目录权限
```bash
# 检查写入权限
touch /workspace/outputs/test_file
rm /workspace/outputs/test_file
```

### 验证环境
```bash
# 检查torch-gcu环境
python -c "import torch; import ptex; print('环境正常')"
```

---

## 🎯 关键配置要点

1. **数据路径**: 所有数据集统一在 `/workspace/data/` 下
2. **代码路径**: 项目代码在 `/workspace/code/`
3. **输出路径**: 训练结果保存在 `/workspace/outputs/`
4. **权重路径**: 预训练权重在 `/workspace/weights/`
5. **容器网络**: 使用主机网络，便于访问和调试

这个配置确保了开发和部署的一致性，支持高效的迭代开发流程。